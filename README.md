# DiddyMac - Multi-Agent Communication System

A sophisticated multi-agent orchestration system powered by OpenAI Agents SDK and GPT-5 series models. The system processes incoming requests from email and WhatsApp, automatically creates and manages rules, and executes complex multi-step tasks through specialized communication agents.

## ðŸš€ Features

**Architecture**: OpenAI Agents SDK with GPT-5 series models  
**Pattern**: Agents-as-tools orchestration (hierarchical delegation)  
**Models**: 
- GPT-5 for complex orchestration and task execution (medium reasoning effort)
- GPT-5-mini for intent classification and rule management (minimal/low reasoning effort)
**API**: Responses API with reasoning and verbosity controls

## Architecture

### Agent Pipeline Flow

```
Input (Email/WhatsApp) 
    â†“
Store in Supabase (input_db)
    â†“
Build Context (message_history)
    â†“
Memory Agent (GPT-5-mini, structured outputs)
â”œâ”€ Intent Classification (minimal reasoning)
â”œâ”€ Rule Extraction (low reasoning)
â””â”€ Rule Filtering (low reasoning)
    â†“
    â”œâ”€â†’ Rule Creation â†’ Store in Supabase (rules_db) â†’ END
    â”‚
    â””â”€â†’ Action Execution
            â†“
        Orchestrator Agent (GPT-5, medium reasoning)
        â”‚  Uses "agents-as-tools" pattern
        â”‚  Coordinates specialist agents:
        â”‚
        â”œâ”€â†’ Calendar Agent (GPT-5-mini, low reasoning)
        â”‚   â””â”€ Google Calendar, Google Meet via Composio
        â”‚
        â”œâ”€â†’ Email Agent (GPT-5, medium reasoning)
        â”‚   â””â”€ Gmail + Google Docs via Composio
        â”‚
        â”œâ”€â†’ Report Writer Agent (GPT-5, medium reasoning)
        â”‚   â””â”€ Google Docs via Composio
        â”‚
        â””â”€â†’ WhatsApp Agent (GPT-5-nano, minimal reasoning)
            â””â”€ WhatsApp via Zapier webhook
            â†“
        Synthesized Result
```

## Components

### 1. Memory Agent (GPT-5-mini)
- **Intent Classification**: Determines rule creation vs action execution
- **Rule Extraction**: Extracts structured rule data
- **Rule Filtering**: Identifies relevant rules for current request
- **Complexity Classification**: Optimizes reasoning effort dynamically

### 2. Orchestrator Agent (GPT-5)
- **Deep Planning**: Analyzes complex requests
- **Agent Coordination**: Calls specialist agents as tools
- **Context Management**: Maintains conversation context
- **Synthesis**: Combines results from multiple agents

### 3. Specialist Sub-Agents

#### Calendar Agent (GPT-5-mini)
- Schedule meetings and create events
- Generate Google Meet links
- Manage attendees and invitations
- Handle recurring events

#### Email Agent (GPT-5)
- Send and draft emails
- Read inbox and search messages
- Manage Gmail communications
- Share Google Docs via email

#### Report Writer Agent (GPT-5)
- Create Google Docs documents
- Professional formatting
- Structured reports and documentation
- Set sharing permissions

#### WhatsApp Agent (GPT-5-nano)
- Send WhatsApp messages via Zapier
- Format confirmations for mobile
- Handle international phone numbers
- Concise message formatting

## Installation

1. **Install Dependencies**:
```bash
pip install -r requirements.txt
```

2. **Environment Variables** (create `.env` file):
```
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
OPENAI_API_KEY=your_openai_api_key
COMPOSIO_API_KEY=your_composio_api_key
ZAPIER_WHATSAPP_WEBHOOK=your_zapier_webhook_url
```

3. **Setup Composio Authentication**:
```bash
composio login
composio add gmail
composio add googlecalendar
composio add googlemeets
composio add googledocs
```

## Database Schema

### input_db Table
```sql
create table public.input_db (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  "user" text null,
  source text null,
  input text null,
  subject text null,
  phone_number text null,
  constraint input_db_pkey primary key (id)
);
```

### rules_db Table
```sql
create table public.rules_db (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  rule_maker text null,
  rule_org text null,
  rule_instruction text null,
  constraint rules_db_pkey primary key (id)
);
```

## Usage

### Webhook Integration

Start the webhook server:
```bash
python webhook_server.py
```

Server will listen for POST requests from Supabase at `http://0.0.0.0:8000`

### Direct Processing

```python
from main import process_request
from datetime import datetime

input_data = {
    "id": 1,
    "created_at": datetime.now().isoformat(),
    "user": "user@example.com",
    "source": "email",
    "input": "Schedule a meeting with John tomorrow at 3pm",
    "subject": "Meeting Request"
}

result = process_request(input_data)
print(result)
```

## Project Structure

```
DiddyMac/
â”œâ”€â”€ agent_system/
â”‚   â”œâ”€â”€ memory_agent.py          # Rule management & classification
â”‚   â”œâ”€â”€ orchestrator_agent.py    # Main orchestration agent
â”‚   â”œâ”€â”€ subagents/
â”‚   â”‚   â”œâ”€â”€ base_subagent.py     # Base class for all subagents
â”‚   â”‚   â”œâ”€â”€ calendar_agent.py    # Calendar operations
â”‚   â”‚   â”œâ”€â”€ email_agent.py       # Email operations
â”‚   â”‚   â”œâ”€â”€ report_writer_agent.py # Document creation
â”‚   â”‚   â””â”€â”€ whatsapp_agent.py    # WhatsApp messaging
â”‚   â””â”€â”€ tools/
â”‚       â””â”€â”€ whatsapp_zapier_tool.py  # Custom WhatsApp tool
â”œâ”€â”€ config/
â”‚   â””â”€â”€ agent_config.py          # Optimization profiles
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ supabase_client.py       # Supabase operations
â”‚   â”œâ”€â”€ logger.py                # Logging utilities
â”‚   â”œâ”€â”€ whatsapp_helper.py       # WhatsApp formatting
â”‚   â”œâ”€â”€ message_utils.py         # Message utilities
â”‚   â”œâ”€â”€ plan_manager.py          # Task planning
â”‚   â””â”€â”€ memory_storage.py        # Memory management
â”œâ”€â”€ test_outputs/                # Test run outputs
â”œâ”€â”€ agent_memory/                # Agent memory storage
â”œâ”€â”€ main.py                      # Main orchestrator
â”œâ”€â”€ webhook_server.py            # Webhook endpoint
â”œâ”€â”€ requirements.txt             # Dependencies
â”œâ”€â”€ .env.example                 # Environment template
â””â”€â”€ README.md                    # This file
```

## Key Features

### Agents-as-Tools Pattern
- Orchestrator calls specialist agents as tools
- Each specialist agent has isolated context
- Agents return synthesized results
- Enables complex multi-agent workflows

### Structured Outputs
- Memory agent uses Pydantic models
- Reliable intent classification
- Rule extraction and filtering
- Reduces parsing errors

### Dynamic Optimization
- Complexity-based reasoning effort
- Optimized token usage
- Balanced speed and intelligence
- Configurable verbosity levels

### Multi-Channel Support
- Email input and output
- WhatsApp messaging
- Automatic confirmations
- Message history context

## Performance

Average execution times (medium reasoning):
- **Rule Creation**: ~3-5 seconds
- **Simple Tasks**: ~30-60 seconds
- **Complex Tasks**: ~120-180 seconds

## Support

For issues or questions, check the `test_outputs/` directory for detailed logs of system execution.

## License

This is a private communication automation system.

